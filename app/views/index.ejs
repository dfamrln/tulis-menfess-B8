<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tulis Menfess - Homepage</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <style>
    body {
      font-family: "Plus Jakarta Sans", sans-serif;
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>

<body class="bg-slate-50 min-h-screen text-slate-800">
  <%- include('partials/navbar') %>

    <div class="max-w-6xl mx-auto px-6 pt-10 pb-6">
      <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-2">
        ðŸ“¢ Timeline Terbaru
      </h2>
      <p class="text-slate-500 text-sm">Apa kata anak-anak hari ini?</p>
    </div>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-20">
      <% if (typeof messages !=='undefined' && messages.length> 0) { %>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% messages.forEach(msg=> { %> <% const limit=100; const isLong=msg.content.length> limit; const
              displayContent = isLong ?
              msg.content.substring(0, limit) + '...' : msg.content; const timeStr =
              new Date(msg.created_at).toLocaleTimeString('id-ID', {hour: '2-digit',
              minute:'2-digit'}); %>

              <div
                class="<%= msg.color %> p-6 rounded-2xl border border-black/5 shadow-sm hover:shadow-lg hover:-translate-y-1 transition duration-300 flex flex-col h-full relative cursor-pointer group"
                onclick="openModal(`<%= msg.sender %>`, `<%= msg.content %>`, `<%= msg.color %>`, `<%= timeStr %>`)">
                <div class="flex-grow">
                  <p class="text-slate-800 text-lg font-medium leading-relaxed whitespace-pre-wrap mb-2">
                    "<%= displayContent %>"
                  </p>

                  <% if(isLong) { %>
                    <span
                      class="text-xs font-bold text-slate-500 group-hover:text-indigo-600 transition underline decoration-dotted">Baca
                      Selengkapnya â†—</span>
                    <% } %>
                </div>

                <div class="mt-4 pt-4 border-t border-black/5 flex justify-between items-center text-xs text-slate-500">
                  <span class="font-bold text-slate-700 truncate max-w-[120px]">From: <%= msg.sender %></span>
                  <span>
                    <%= timeStr %>
                  </span>
                </div>
                <div
                  class="absolute bottom-4 right-4 flex items-center gap-3 text-sm z-10"
                  onclick="event.stopPropagation();"
                >
                  <form method="POST" action="/like/<%= msg.id %>" onsubmit="event.stopPropagation();">
                    <button type="submit" onclick="event.stopPropagation();"
                      class="flex items-center gap-2 text-slate-500 hover:text-green-500 transition-colors">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                          d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z" />
                      </svg>

                      <span class="like-count">
                        <%= msg.likes || 0 %>
                      </span>
                    </button>
                  </form>

                  <form method="POST" action="/dislike/<%= msg.id %>" onsubmit="event.stopPropagation();">
                    <button type="submit" onclick="event.stopPropagation();"
                      class="flex items-center gap-2 text-slate-500 hover:text-red-500 transition-colors">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                          d="M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54" />
                      </svg>

                      <span class="dislike-count">
                        <%= msg.dislikes || 0 %>
                      </span>
                    </button>
                  </form>
                </div>
              </div>
              <% }) %>
        </div>

        <% } else { %>
          <div class="text-center py-20 bg-white rounded-3xl border border-dashed border-slate-300 mx-auto max-w-2xl">
            <div class="text-5xl mb-4">ðŸ“­</div>
            <p class="text-slate-500 font-medium">
              Sepi banget... Yuk jadi yang pertama curhat!
            </p>
          </div>
          <% } %>
    </main>

    <a href="/create"
      class="fixed bottom-8 right-8 bg-indigo-600 text-white p-4 rounded-full shadow-2xl hover:bg-indigo-700 transition transform hover:scale-110 hover:-rotate-6 z-40 flex items-center justify-center group">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
      </svg>
      <span
        class="absolute right-full mr-4 bg-slate-800 text-white text-xs font-bold px-3 py-1 rounded-lg opacity-0 group-hover:opacity-100 transition whitespace-nowrap">Tulis
        Menfess</span>
    </a>

    <div id="menfessModal" class="relative z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity opacity-0" id="modalBackdrop"></div>

      <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
          <div
            class="relative transform overflow-hidden rounded-3xl text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-lg scale-95 opacity-0"
            id="modalPanel">
            <div id="modalCard" class="bg-white px-8 py-8 sm:p-10 border-4 border-white">
              <div class="absolute top-4 right-4">
                <button type="button" onclick="closeModal()"
                  class="text-black/20 hover:text-black/50 transition rounded-full p-1 hover:bg-black/5">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              </div>

              <div>
                <div class="flex items-center gap-2 mb-6 text-sm text-slate-500/80 uppercase tracking-wider">
                  <span id="modalSender">From: ???</span>
                  <span>â€¢</span>
                  <span id="modalTime">00:00</span>
                </div>

                <div class="mt-2">
                  <p id="modalContent" class="text-2xl text-slate-800 leading-relaxed whitespace-pre-wrap font-sans">
                  </p>
                </div>
              </div>

              <div class="mt-8 pt-6 border-t border-black/5 text-center">
                <button type="button" onclick="closeModal()"
                  class="inline-flex w-full justify-center rounded-xl bg-black/5 px-3 py-3 text-sm font-semibold text-slate-700 shadow-sm hover:bg-black/10 transition">
                  Tutup
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include('partials/footer') %>

      <script>
        const modal = document.getElementById("menfessModal");
        const backdrop = document.getElementById("modalBackdrop");
        const panel = document.getElementById("modalPanel");
        const modalCard = document.getElementById("modalCard");

        const modalContent = document.getElementById("modalContent");
        const modalSender = document.getElementById("modalSender");
        const modalTime = document.getElementById("modalTime");

        function openModal(sender, content, color, time) {
          modalContent.innerText = content;
          modalSender.innerText = "From: " + sender;
          modalTime.innerText = time;

          const colors = [
            "bg-white",
            "bg-red-100",
            "bg-blue-100",
            "bg-green-100",
            "bg-yellow-100",
            "bg-purple-100",
          ];
          modalCard.classList.remove(...colors);

          modalCard.classList.add(color);

          modal.classList.remove("hidden");

          setTimeout(() => {
            backdrop.classList.remove("opacity-0");
            panel.classList.remove("scale-95", "opacity-0");
            panel.classList.add("scale-100", "opacity-100");
          }, 10);
        }

        function closeModal() {
          backdrop.classList.add("opacity-0");
          panel.classList.remove("scale-100", "opacity-100");
          panel.classList.add("scale-95", "opacity-0");

          setTimeout(() => {
            modal.classList.add("hidden");
          }, 300);
        }

        backdrop.addEventListener("click", closeModal);

        // server-side like/dislike routes are used via forms; no client-side vote persistence here
      </script>
</body>

</html>